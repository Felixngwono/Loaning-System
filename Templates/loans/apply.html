{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2>Apply for a Loan</h2>

  <form method="POST">
    {% csrf_token %}

    {% if form.errors %}
    <div class="alert alert-danger">
      <strong>Please correct the following errors:</strong>
      <ul class="mb-0 ps-3">
        {% for field in form %}
          {% for error in field.errors %}
            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {% if messages %}
    <div class="alert alert-info">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
    {% endif %}

    <div class="mb-3">
      <label for="borrower" class="form-label">Borrower</label>
      {% render_field form.borrower class="form-control" id="borrower" %}
    </div>
    <div class="mb-3">
      <label for="national_id" class="form-label">national_id</label>
      {% render_field form.national_id class="form-control" id="national_id" %}
    </div>
    <div class="mb-3">
      <label for="phone" class="form-label">phone</label>
      {% render_field form.phone class="form-control" id="phone" %}
    </div>
    <div class="mb-3">
      <label for="occupation" class="form-label">occupation</label>
      {% render_field form.occupation class="form-control" id="occupation" %}
    </div>
    <div class="mb-3">
      <label for="purpose" class="form-label">Purpose of Loan</label>
      {% render_field form.purpose class="form-control" id="purpose" %}
    </div>

    <div class="mb-3">
      <label for="status" class="form-label">Status</label>
      {% render_field form.status class="form-control" id="status" %}
    </div>
    <div class="mb-3">
      <label for="address" class="form-label">address</label>
      {% render_field form.address class="form-control" id="address" %}
    </div>
    <div class="mb-3">
      <label for="amount" class="form-label">Amount</label>
      {% render_field form.amount class="form-control" id="amount" %}
    </div>

    <div class="mb-3">
      <label for="term_months" class="form-label">Term Months</label>
      {% render_field form.term_months class="form-control" id="term_months" %}
    </div>

    <div class="mb-3">
      <label for="interest_rate" class="form-label">Interest Rate</label>
      {% render_field form.interest_rate class="form-control" id="interest_rate" %}
    </div>

    <button class="btn btn-primary" type="submit" data-bs-toggle="modal" data-bs-target='#suceess_message'>Submit Application</button>
  </form>
  <a href="{% url 'index' %}" class="btn btn-secondary mt-3">Back to Loans</a>
</div>
<div class="modal" tabindex="-1" role="dialog" id='suceess_message'>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Application message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% for message in messages %}
         <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}

      </div>
      <div class="modal-footer">
 {% if user.is_authenticated %}
          <a href="{% url 'index' %}" class="btn btn-primary">submit application</a>
        {% endif %}       
         <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% if show_modal %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var suceess_messageModal = new bootstrap.Modal(document.getElementById('suceess_message'));
    suceess_messageModal.show();
  });
</script>
{% endif %}
{% include "footer.html" %}
{% endblock %}
